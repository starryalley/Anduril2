// Wurkkos TS10 (originally used Sofirn SP36-t1616 firmware) config options for Anduril using the Attiny1616
// same as  the  BLF Q8, mostly
#include "hwdef-BLF_Q8-T1616.h"
#undef MODEL_NUMBER
#define MODEL_NUMBER "0714"
// ATTINY: 1616

#define USE_DYN_PWM
#define PWM_BITS 16 // necessary for dynamic PWM

// author: SammysHP
// level 1 by hand, for the rest
// level_calc.py 7.01 2 149 7135 3 0.5 125 FET 1 10 1200 --pwm dyn:63:2048:255
#define RAMP_LENGTH 150
#define PWM1_LEVELS 1,3,3,4,5,6,7,8,9,10,12,13,14,16,17,19,20,22,24,25,27,29,31,33,35,37,40,42,44,47,49,52,54,57,59,62,64,67,70,72,75,77,80,82,85,87,89,91,93,95,96,98,99,100,100,101,100,100,99,97,95,93,90,86,82,87,91,96,100,106,111,116,122,128,134,141,147,155,162,169,177,186,194,203,213,222,232,243,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0
#define PWM2_LEVELS 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,4,6,7,9,11,12,14,16,18,20,22,24,27,29,31,34,37,39,42,45,48,51,54,57,61,64,68,72,75,79,83,88,92,97,101,106,111,116,121,126,132,138,144,150,156,162,169,176,183,190,197,205,213,221,229,237,246,255
#define PWM_TOPS 2047,2047,1198,1322,1584,1676,1701,1691,1662,1622,1774,1703,1631,1692,1613,1639,1558,1564,1559,1478,1464,1444,1420,1392,1361,1329,1331,1293,1256,1246,1207,1192,1152,1133,1094,1074,1035,1013,991,954,932,897,875,842,820,790,760,731,704,678,646,622,593,566,534,510,478,452,423,393,364,338,310,280,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
#define MAX_1x7135 90
#define HALFSPEED_LEVEL 2
#define QUARTERSPEED_LEVEL 2
#define DEFAULT_LEVEL 65
#define THERM_FASTER_LEVEL 130
#define MIN_THERM_STEPDOWN 65

#define RAMP_SMOOTH_FLOOR 1
#define RAMP_SMOOTH_CEIL 130

// 10 [50] 90 130
#define RAMP_DISCRETE_FLOOR 10
#define RAMP_DISCRETE_CEIL 130
#define RAMP_DISCRETE_STEPS 4
#define SIMPLE_UI_FLOOR RAMP_SMOOTH_FLOOR
#define SIMPLE_UI_CEIL RAMP_SMOOTH_CEIL
#define SIMPLE_UI_STEPS 7

// indicator LED is the single-colour AUX LED on TS10
#define USE_INDICATOR_LED
#ifdef USE_INDICATOR_LED_WHILE_RAMPING
#undef USE_INDICATOR_LED_WHILE_RAMPING
#endif

// the high AUX LED mode on this light uses too much power
// off mode: low (1)
// lockout: blinking low (4)
#ifdef INDICATOR_LED_DEFAULT_MODE
#undef INDICATOR_LED_DEFAULT_MODE
#define INDICATOR_LED_DEFAULT_MODE ((4<<4) + 1)
#endif

// voltage readings were a little high with the Q8 value
#undef VOLTAGE_FUDGE_FACTOR
#define VOLTAGE_FUDGE_FACTOR 5  // add 0.25V, not 0.35V

// don't blink during the ramp
#undef BLINK_AT_RAMP_MIDDLE
#undef BLINK_AT_RAMP_CEIL

// candle mode use static PWM
// level_calc.py 5.01 2 150 7135 1 0.1 150 FET 1 10 1200 --pwm 4096
// #define PWM1_LEVELS_STROBE 1,2,2,3,4,5,6,7,8,10,12,13,16,18,20,23,26,30,34,38,42,47,52,58,64,71,78,86,95,104,114,124,136,148,160,174,189,205,221,239,258,278,299,321,345,370,397,425,455,486,519,554,591,629,670,712,757,804,853,905,959,1015,1075,1137,1202,1269,1340,1414,1491,1571,1655,1743,1834,1928,2027,2130,2236,2347,2463,2583,2707,2836,2971,3110,3254,3404,3559,3719,3886,4058,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,4096,0
// #define PWM2_LEVELS_STROBE 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,36,65,94,124,156,188,222,257,292,329,367,407,447,489,532,576,622,669,718,768,819,872,927,983,1041,1100,1161,1224,1288,1354,1422,1492,1564,1638,1713,1791,1871,1953,2037,2123,2211,2302,2395,2490,2588,2688,2791,2896,3003,3114,3227,3342,3461,3582,3706,3833,3963,4096
// #define PWM_TOP_CANDLE 0x3FFF // 16383, 14bit PWM, max power is only 25% but it will have smooth transitions
// #define PWM_TOP_FIREWORK 0xFFF // 4095, 12bit PWM, max power is 100%

// other configs
#define DEFAULT_2C_STYLE 1
#define SIMPLE_UI_ACTIVE 0
#define RAMP_STYLE 0
#define USE_SIMPLE_UI_RAMPING_TOGGLE
#define USE_SOFT_FACTORY_RESET
#define USE_LOWPASS_WHILE_ASLEEP

// increase PWM by 2^2
#define ULTRA_LOW_MOON_FACTOR 2
#define USE_CANDLE_PWM_FACTOR